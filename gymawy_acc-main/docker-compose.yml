services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: gemawi-backend
    restart: always
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - PORT=5000
      - MONGODB_URI=${MONGODB_URI}
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRE=30d
      - FRONTEND_URL=${FRONTEND_URL:-https://gymmawy.net}
      - CORS_ORIGIN=${CORS_ORIGIN:-https://gymmawy.net}
      - RATE_LIMIT_WINDOW=15
      - RATE_LIMIT_MAX=100
      - EMAIL_HOST=${EMAIL_HOST}
      - EMAIL_PORT=${EMAIL_PORT:-587}
      - EMAIL_USER=${EMAIL_USER}
      - EMAIL_PASS=${EMAIL_PASS}
      - EMAIL_FROM=${EMAIL_FROM}
    networks:
      - gemawi-network

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    container_name: gemawi-frontend
    restart: always
    ports:
      - "8080:80"
    depends_on:
      - backend
    networks:
      - gemawi-network
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro

networks:
  gemawi-network:
    driver: bridge
